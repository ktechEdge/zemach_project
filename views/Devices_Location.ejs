<%- include ("./Gen_Edge_Design_Main/page_top.ejs") %>

<div class="device-table-container">
    <table id="device-table">
        <thead>
        <tr>
            <th>Device Number</th>
            <th>Connected Plants</th>
        </tr>
        </thead>
        <tbody id="device-data">

        </tbody>
    </table>
</div>

<script>
    function fetchDeviceData() {
        return fetch('/device_data')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => data)
            .catch(error => {
                console.error('Error fetching device data:', error);
            });
    }

    function groupPlantsByDevice(plants) {
        const deviceMap = {};
        plants.forEach(plant => {
            const deviceId = plant.device;
            const plantName = plant.plants;
            if (!deviceMap[deviceId]) {
                deviceMap[deviceId] = [];
            }
            deviceMap[deviceId].push(...plantName);
        });
        return deviceMap;
    }

    function generateDeviceTable(deviceMap) {
        const deviceDataContainer = document.getElementById('device-data');
        Object.keys(deviceMap).forEach(deviceId => {
            const deviceRow = document.createElement('tr');
            deviceRow.innerHTML = `
                <td>${deviceId}</td>
                <td>${deviceMap[deviceId].join(', ')}</td>
            `;
            deviceDataContainer.appendChild(deviceRow);
        });
    }

    fetchDeviceData()
        .then(plants => {
            const deviceMap = groupPlantsByDevice(plants);
            generateDeviceTable(deviceMap);
        })
        .catch(error => {
            console.error('Error fetching device data:', error);
        });
</script>

<style>
    .device-table-container {
        margin: 20px;
        direction: ltr;
    }
    #device-table {
        width: 100%;
        border-collapse: collapse;
    }
    #device-table th, #device-table td {
        border: 1px solid #ddd;
        padding: 8px;
    }
    #device-table th {
        background-color: #f2f2f2;
    }
</style>

<%- include ("./Gen_Edge_Design_Main/page_bottom.ejs") %>
